---
---
<nav class="route-map" aria-label="Trip route progress">
  <!-- Desktop: vertical sidebar map -->
  <div class="route-map-desktop">
    <svg viewBox="0 0 800 600" class="route-svg" aria-hidden="true">
      <!-- Outbound route -->
      <path class="route-path route-path--outbound"
        d="M 720,145
           C 700,155 680,170 660,185
           C 640,200 610,220 580,235
           C 550,250 520,258 490,260
           C 460,262 430,258 400,252
           C 370,246 340,238 310,235
           C 280,232 260,235 240,242
           C 220,249 200,260 180,275
           C 160,290 145,308 135,328
           C 125,348 120,365 118,380
           C 116,395 118,408 122,418"
      />
      <!-- Local loop -->
      <path class="route-path route-path--local"
        d="M 122,418
           C 118,430 112,438 108,445
           C 104,452 98,458 95,462
           C 92,466 90,468 92,470
           C 94,472 100,470 108,465
           C 116,460 125,452 130,445
           C 135,438 138,430 135,425
           C 132,420 128,418 122,418"
      />
      <!-- Return route -->
      <path class="route-path route-path--return"
        d="M 122,418
           C 130,410 145,398 165,385
           C 185,372 210,358 240,345
           C 270,332 305,320 340,310
           C 375,300 410,292 445,282
           C 480,272 510,260 540,245
           C 570,230 595,215 615,198
           C 635,181 650,168 662,158
           C 674,148 685,142 695,140
           C 705,138 712,140 718,144
           C 722,146 722,147 720,145"
      />

      <!-- Pins -->
      <circle class="pin" cx="720" cy="145" r="4"><title>Hooksett, NH</title></circle>
      <circle class="pin" cx="580" cy="235" r="4"><title>Shelburne Falls</title></circle>
      <circle class="pin" cx="490" cy="260" r="4"><title>Hairpin Turn</title></circle>
      <circle class="pin" cx="400" cy="252" r="4"><title>Williamstown</title></circle>
      <circle class="pin pin--major" cx="122" cy="418" r="5"><title>Ithaca, NY</title></circle>
      <circle class="pin" cx="108" cy="445" r="4"><title>Taughannock Falls</title></circle>
      <circle class="pin" cx="95" cy="462" r="4"><title>Watkins Glen</title></circle>
      <circle class="pin" cx="135" cy="425" r="4"><title>Ganondagan</title></circle>
      <circle class="pin" cx="92" cy="470" r="4"><title>Corning</title></circle>
      <circle class="pin" cx="662" cy="158" r="4"><title>Quechee Gorge</title></circle>
      <circle class="pin" cx="685" cy="142" r="4"><title>Woodstock, VT</title></circle>

      <!-- Pin labels -->
      <text class="pin-label" x="720" y="132" text-anchor="middle">Hooksett</text>
      <text class="pin-label" x="568" y="224" text-anchor="end">Shelburne Falls</text>
      <text class="pin-label" x="490" y="247" text-anchor="middle">Hairpin Turn</text>
      <text class="pin-label" x="400" y="240" text-anchor="middle">Williamstown</text>
      <text class="pin-label" x="108" y="408" text-anchor="end">Ithaca</text>
      <text class="pin-label" x="94" y="442" text-anchor="end">Taughannock</text>
      <text class="pin-label" x="80" y="460" text-anchor="end">Watkins Glen</text>
      <text class="pin-label" x="150" y="420" text-anchor="start">Ganondagan</text>
      <text class="pin-label" x="78" y="474" text-anchor="end">Corning</text>
      <text class="pin-label" x="648" y="150" text-anchor="end">Quechee</text>
      <text class="pin-label" x="700" y="135" text-anchor="start">Woodstock</text>
    </svg>
  </div>

  <!-- Mobile: horizontal progress bar -->
  <div class="route-map-mobile">
    <div class="route-progress-track">
      <div class="route-progress-fill"></div>
      <div class="route-dots">
        <span class="route-dot" data-label="NH" title="Hooksett, NH"></span>
        <span class="route-dot" data-label="MA" title="Shelburne Falls"></span>
        <span class="route-dot" data-label="IT" title="Ithaca, NY"></span>
        <span class="route-dot" data-label="VT" title="Quechee Gorge"></span>
        <span class="route-dot" data-label="NH" title="Home"></span>
      </div>
    </div>
  </div>
</nav>

<style>
  /* ===========================
     Route Map — Desktop Sidebar
     =========================== */
  .route-map {
    position: fixed;
    z-index: 50;
  }

  .route-map-desktop {
    display: none;
  }

  .route-map-mobile {
    display: block;
  }

  @media (min-width: 769px) {
    .route-map {
      top: 0;
      left: 0;
      bottom: 0;
      width: 60px;
      background: var(--j-bg-deep, #0f1114);
      border-right: 1px solid var(--j-accent-slate, #4a6670);
    }

    .route-map-desktop {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100%;
      padding: 80px 6px 20px; /* top padding for site header */
      box-sizing: border-box;
    }

    .route-map-mobile {
      display: none;
    }

    .route-svg {
      width: 100%;
      height: 100%;
      color: var(--j-accent-gold, #c4956a);
    }

    .route-path {
      fill: none;
      stroke: currentColor;
      stroke-width: 2;
      stroke-linecap: round;
      stroke-linejoin: round;
      /* Scroll-driven draw animation */
      stroke-dasharray: var(--path-length, 1000);
      stroke-dashoffset: var(--path-length, 1000);
      animation: draw-route linear forwards;
      animation-timeline: scroll(root);
      animation-range: 0% 100%;
    }

    .route-path--outbound {
      --path-length: 900;
      animation-range: 0% 40%;
    }

    .route-path--local {
      --path-length: 200;
      animation-range: 35% 70%;
    }

    .route-path--return {
      --path-length: 850;
      animation-range: 65% 100%;
    }

    @keyframes draw-route {
      to {
        stroke-dashoffset: 0;
      }
    }

    .pin {
      fill: var(--j-bg-deep, #0f1114);
      stroke: var(--j-accent-gold, #c4956a);
      stroke-width: 1.5;
      opacity: 0;
      animation: reveal-pin linear forwards;
      animation-timeline: scroll(root);
    }

    .pin--major {
      fill: var(--j-accent-gold, #c4956a);
      stroke-width: 2;
    }

    /* Stagger pin reveal based on route position */
    .pin:nth-of-type(1) { animation-range: 0% 2%; }
    .pin:nth-of-type(2) { animation-range: 18% 20%; }
    .pin:nth-of-type(3) { animation-range: 14% 16%; }
    .pin:nth-of-type(4) { animation-range: 20% 22%; }
    .pin:nth-of-type(5) { animation-range: 35% 37%; }
    .pin:nth-of-type(6) { animation-range: 42% 44%; }
    .pin:nth-of-type(7) { animation-range: 50% 52%; }
    .pin:nth-of-type(8) { animation-range: 58% 60%; }
    .pin:nth-of-type(9) { animation-range: 65% 67%; }
    .pin:nth-of-type(10) { animation-range: 80% 82%; }
    .pin:nth-of-type(11) { animation-range: 85% 87%; }

    @keyframes reveal-pin {
      to {
        opacity: 1;
      }
    }

    .pin-label {
      font-family: var(--j-font-mono, 'JetBrains Mono', monospace);
      font-size: 9px;
      fill: var(--j-text-secondary, #a8a090);
      opacity: 0;
      transition: opacity 0.2s ease;
      pointer-events: none;
    }

    .pin:hover ~ .pin-labels .pin-label,
    .route-svg:hover .pin-label {
      opacity: 0;
    }

    .pin:hover + text.pin-label {
      opacity: 1;
    }

    /* Show labels on SVG hover for the associated pin */
    .route-svg:hover .pin-label {
      opacity: 0.6;
    }
  }

  /* ===========================
     Route Map — Mobile Progress Bar
     =========================== */
  @media (max-width: 768px) {
    .route-map {
      top: 52px; /* below site header */
      left: 0;
      right: 0;
      height: 4px;
    }

    .route-progress-track {
      position: relative;
      width: 100%;
      height: 4px;
      background: rgba(74, 102, 112, 0.3);
    }

    .route-progress-fill {
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      width: 0%;
      background: var(--j-accent-gold, #c4956a);
      animation: fill-progress linear forwards;
      animation-timeline: scroll(root);
      animation-range: 0% 100%;
    }

    @keyframes fill-progress {
      to {
        width: 100%;
      }
    }

    .route-dots {
      position: absolute;
      top: -2px;
      left: 5%;
      right: 5%;
      display: flex;
      justify-content: space-between;
      height: 8px;
    }

    .route-dot {
      width: 4px;
      height: 4px;
      border-radius: 50%;
      background: var(--j-accent-gold, #c4956a);
      opacity: 0.4;
      cursor: pointer;
      position: relative;
    }

    .route-dot::after {
      content: attr(data-label);
      position: absolute;
      top: 8px;
      left: 50%;
      transform: translateX(-50%);
      font-family: var(--j-font-mono, 'JetBrains Mono', monospace);
      font-size: 8px;
      color: var(--j-text-secondary, #a8a090);
      white-space: nowrap;
      opacity: 0;
      transition: opacity 0.2s ease;
      pointer-events: none;
    }

    .route-dot:active::after {
      opacity: 1;
    }
  }

  /* ===========================
     Fallbacks
     =========================== */
  @supports not (animation-timeline: scroll()) {
    .route-path {
      stroke-dashoffset: 0;
    }
    .pin {
      opacity: 1;
    }
    .route-progress-fill {
      width: 100%;
    }
    .pin-label {
      opacity: 0.6;
    }
  }

  @media (prefers-reduced-motion: reduce) {
    .route-path {
      stroke-dashoffset: 0;
      animation: none;
    }
    .pin {
      opacity: 1;
      animation: none;
    }
    .route-progress-fill {
      width: 100%;
      animation: none;
    }
    .pin-label {
      opacity: 0.6;
    }
  }
</style>
